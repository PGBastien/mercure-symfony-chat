{% extends 'base.html.twig' %}

{% block title %}Hello DefaultController!{% endblock %}

{% block body %}

<div class="container m-5 p-5">


<div class="alert" id="message">
</div>

<div class="bg-light">
  
  <h1> Go to admin page tp publish a notification ! </h1>
   <a href="{{ path('admin') }}" class="btn btn-outline-primary">
          Admin Page Here !
   </a>
</div>
</div>

<script type="text/javascript">

const url = new URL('http://localhost:3000/.well-known/mercure');
url.searchParams.append('topic', 'http://monsite.com/ping');
const eventSource = new EventSource(url);
eventSource.onmessage = e => {
  const data = JSON.parse(e.data);
  const div = document.createElement("div");
  div.setAttribute("class", "alert alert-success");
  div.innerHTML = data.message;

  document.querySelector("div#message").appendChild(div);
}; 


</script>


{% endblock %}

